Metadata-Version: 2.4
Name: factor-engine
Version: 0.1.0
Summary: Chilean multi-factor equity research engine
Author-email: Systematic Investing Team <quant@example.com>
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: pydantic>=2.6
Requires-Dist: typer>=0.12
Requires-Dist: SQLAlchemy>=2.0
Requires-Dist: pandas>=2.1
Requires-Dist: numpy>=1.26
Requires-Dist: yfinance>=0.2
Requires-Dist: python-dotenv>=1.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: rich>=13.7
Requires-Dist: requests>=2.31
Requires-Dist: tabulate>=0.9
Requires-Dist: notion-client>=2.2
Requires-Dist: streamlit>=1.30
Requires-Dist: plotly>=5.18
Provides-Extra: dev
Requires-Dist: pytest>=8.0; extra == "dev"
Requires-Dist: pytest-mock>=3.10; extra == "dev"
Requires-Dist: ruff>=0.2; extra == "dev"
Requires-Dist: mypy>=1.8; extra == "dev"

# Factor Engine

A deterministic, research-oriented multi-factor equity pipeline targeting Chilean IPSA constituents. The system ingests Yahoo Finance data, caches it in SQLite, computes validated factor signals, assembles liquidity-aware portfolios, and synchronizes snapshots to Notion dashboards with guarded overrides.

## Features
- Survivorship-aware universe membership table with optional bias flagging.
- Provider abstraction (`DataProvider`) with a Yahoo Finance implementation and provider logs for reproducibility.
- Single SQLite database (`sieng.db`) storing runs, symbols, prices, factors, liquidity metrics, and audits.
- Adjusted-close-driven factor set (momentum, risk, liquidity) and liquidity thresholds for realistic Chilean execution.
- CLI entry point `factor-engine` to run ingestion, factor calc, signal generation, portfolio builds, backtests, Notion sync, and override workflows.

## Getting Started
1. **Create and activate a virtual environment**
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate  # Windows: .venv\\Scripts\\activate
   ```
2. **Install dependencies**
   ```bash
   pip install --upgrade pip
   pip install -e .[dev]
   ```
3. **Configure environment variables**
   ```bash
   cp .env.example .env
   # edit .env and set NOTION_TOKEN=ntn_************************
   ```
4. **Initialize the database**
   ```bash
   factor-engine initdb
   ```
5. **(Optional) Import historical universe membership**
   ```bash
   factor-engine universe-import data/universe_membership.csv
   ```
6. **Ingest data**
   ```bash
   factor-engine ingest --as-of 2024-12-31 --start 2023-01-01 --end 2024-12-31
   ```
7. **Compute factors and build a portfolio**
   ```bash
   factor-engine factors --run-id <RUN_ID_FROM_INGEST>
   factor-engine signals --run-id <RUN_ID_FROM_INGEST>
   factor-engine portfolio --run-id <RUN_ID_FROM_INGEST>
   ```
8. **(Optional) Apply Notion overrides**
   ```bash
   factor-engine overrides-apply --allow-overrides
   ```

## Configuration Files
- `configs/providers.yml` – Provider registry (default: Yahoo).
- `configs/universe/ipsa.yml` – Canonical IPSA universe constituents.
- `configs/strategy/default.yml` – Strategy execution timing, liquidity filters, and transaction costs.
- `configs/notion.yml` – Notion database IDs for dashboards, overrides, and tracking tables.
- `data/universe_membership.csv` – Historical membership ranges (import via `factor-engine universe-import`).

## Notion Integration & Overrides
- Store your Notion integration token in `.env` as `NOTION_TOKEN=ntn_...`. The CLI loads it automatically via `python-dotenv`.
- Update `configs/notion.yml` if database IDs change, and define which fields are whitelisted for overrides (e.g., factor weights, liquidity filters).
- Use `factor-engine overrides-apply --allow-overrides` to fetch enabled records from the Notion “Overrides” database. Only whitelisted fields with `Override Enabled = true` are logged to the `override_audit` table; the `--allow-overrides` flag acts as an explicit approval gate.

## Structure
```
src/factor_engine/
  cli.py               # Typer CLI entrypoint
  config/              # YAML loaders and Pydantic models
  db/                  # SQLAlchemy models and session helpers
  providers/           # Data provider abstractions + Yahoo implementation
  ingest/              # Ingestion orchestration with provider logging
  factors/             # Factor engine (momentum, volatility, liquidity)
  signals/             # Composite scoring + liquidity guards
  portfolio/           # Score-weighted builder with liquidity caps
  backtest/            # Execution-timing-aware runner skeleton
  notion/              # Guarded Notion sync + overrides entrypoints
```

## Determinism
- Every CLI run registers an entry in `runs` keyed by UUID with `as_of_date`, parameters, and survivorship flag. Pass `--run-id` to downstream commands to operate on the same deterministic snapshot.
- Provider calls store hashed params/responses in `provider_logs` for later audits.
- `factor-engine snapshot <run-id>` copies `sieng.db` into `artifacts/run_<id>.db` (or a custom path) for immutable archives.
- If the active universe for a given rebalance date cannot be derived from `universe_membership`, the CLI flags the run as survivorship-biased and falls back to the static YAML list.
- Set `FACTOR_ENGINE_DB_PATH=/custom/path.db` to direct runs/tests to an alternate SQLite database (defaults to `sieng.db`).

## Next Steps
- Populate historical IPSA membership sources and enforce lookups per rebalance date.
- Flesh out backtest path-dependent logic (walk-forward scheduler, transaction cost accounting).
- Implement Notion dashboards + overrides audit trail once API credentials available.
- Add regression tests with fixture datasets and CLI smoke suite.

> Disclaimer: This software is provided for research and educational purposes only. It does not constitute investment advice.
